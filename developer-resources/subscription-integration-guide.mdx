---
title: Subscription Integration Guide  
description: This guide will help you integrate the Dodo Payments Subscription Product into your website.  
icon: "repeat"
---

## Overview

This comprehensive guide walks you through integrating recurring billing and subscription management with Dodo Payments. Learn how to create subscriptions, handle billing cycles, manage plan changes, and implement webhooks for real-time subscription events.

<CardGroup cols={2}>
  <Card title="Quick Start" icon="bolt" href="#api-integration">
    Get started with subscription payment links in minutes
  </Card>
  <Card title="Plan Management" icon="settings" href="#changing-subscription-plans">
    Upgrade, downgrade, and modify subscription plans
  </Card>
  <Card title="Webhook Events" icon="webhook" href="#webhooks">
    Handle subscription lifecycle events with webhooks
  </Card>
  <Card title="On-Demand Billing" icon="clock" href="#on-demand-subscriptions">
    Flexible billing for usage-based pricing models
  </Card>
</CardGroup>

## Prerequisites  

Before integrating subscription billing, ensure you have:

<Note>
**Required:**
- A Dodo Payments merchant account ([get started here](https://demo.dodopayments.com/))
- API credentials (API key and webhook secret key) from your dashboard
- At least one subscription product created in your dashboard
- A webhook endpoint for handling subscription events

**Recommended:**
- Understanding of recurring billing concepts
- Familiarity with webhook handling
- SSL certificate for webhook endpoints
</Note>

### Dashboard Setup

<Steps>
  <Step title="Create Subscription Product">
    Navigate to your [Dodo Payments Dashboard](https://app.dodopayments.com/) and create a subscription product with:
    - Billing frequency (monthly, yearly, etc.)
    - Pricing structure
    - Trial period (optional)
  </Step>
  <Step title="Configure Webhooks">
    Set up webhook endpoints to receive subscription events. See our [webhook setup guide](/developer-resources/webhooks) for details.
  </Step>
  <Step title="Test Configuration">
    Test your subscription flow using test mode and verify webhook delivery.
  </Step>
</Steps>

For detailed dashboard setup instructions, see our [integration guide](/developer-resources/integration-guide#dashboard-setup).  

## API Integration  

### Creating Subscription Payment Links

Dodo Payments offers two approaches for subscription payment link creation:

<Tabs>
  <Tab title="Static Payment Links">
    **Best for:** Simple subscriptions with predefined products
    
    ```text
    https://checkout.dodopayments.com/buy/{subscription_product_id}?quantity=1&redirect_url={return_url}
    ```
    
    **Example:**
    ```text
    https://checkout.dodopayments.com/buy/pdt_sub_abc123?quantity=1&redirect_url=https://yourapp.com/success
    ```
    
    **Query Parameters:**
    - `quantity`: Number of subscriptions (default: 1)
    - `redirect_url`: Where to redirect after subscription setup
    - `email`: Pre-fill customer email
    - `firstName`: Pre-fill first name
    - `lastName`: Pre-fill last name
    
    See our [static payment links guide](/developer-resources/integration-guide#1-static-payment-links) for more details.
  </Tab>
  
  <Tab title="Dynamic Payment Links">
    **Best for:** Custom pricing, multiple products, or personalized subscriptions
    
    Create subscription payment links programmatically using our API or SDKs:
    
    <Note>
    **Important:** Set `payment_link: true` in your request to receive a payment link instead of processing the payment directly.
    </Note>
    
    **API Endpoints:**
    - **Subscription API:** [POST /subscriptions](/api-reference/subscriptions/post-subscriptions) - For recurring billing
    - **One-time Payment API:** [POST /payments](/api-reference/payments/post-payments) - For single payments
    
    This guide focuses on subscription creation. For one-time payments, see our [integration guide](/developer-resources/integration-guide).
  </Tab>
</Tabs>

### SDK Examples


<Tabs>  
<Tab title="Node.js SDK">
    ```javascript
   import DodoPayments from 'dodopayments';

const client = new DodoPayments({
  bearerToken: process.env['DODO_PAYMENTS_API_KEY'], // This is the default and can be omitted
});

async function main() {
  const subscription = await client.subscriptions.create({
    billing: { city: 'city', country: 'IN', state: 'state', street: 'street', zipcode: 89789 },
    customer: { customer_id: 'customer_id' },
    product_id: 'product_id',
    payment_link: true,
    return_url: 'https://example.com/success',
    quantity: 1,
  });

  console.log(subscription.subscription_id);
}

main();
    ```
  </Tab>
  <Tab title="Python SDK">
  ```python
import os
from dodopayments import DodoPayments

client = DodoPayments(
    bearer_token=os.environ.get("DODO_PAYMENTS_API_KEY"),  # This is the default and can be omitted
)
subscription = client.subscriptions.create(
    billing={
        "city": "city",
        "country": "IN",
        "state": "state",
        "street": "street",
        "zipcode": 54535,
    },
    customer={
        "customer_id": "customer_id"
    },
    product_id="product_id",
    quantity=1,
    payment_link: true,
    return_url: 'https://example.com/success',
)
print(subscription.subscription_id)
  ```
  </Tab>
  <Tab title="GO SDK">
  ```go
package main

import (
  "context"
  "fmt"

  "github.com/dodopayments/dodopayments-go"
  "github.com/dodopayments/dodopayments-go/option"
)

func main() {
  client := dodopayments.NewClient(
    option.WithBearerToken("My Bearer Token"), // defaults to os.LookupEnv("DODO_PAYMENTS_API_KEY")
  )
  subscription, err := client.Subscriptions.New(context.TODO(), dodopayments.SubscriptionNewParams{
    Billing: dodopayments.F(dodopayments.SubscriptionNewParamsBilling{
      City: dodopayments.F("city"),
      Country: dodopayments.F(dodopayments.CountryCodeIn),
      State: dodopayments.F("state"),
      Street: dodopayments.F("street"),
      Zipcode: dodopayments.F(int64(65787)),
    }),
    Customer: dodopayments.F[dodopayments.SubscriptionNewParamsCustomerUnion](dodopayments.SubscriptionNewParamsCustomerAttachExistingCustomer{
      CustomerID: dodopayments.F("customer_id"),
    }),
    ProductID: dodopayments.F("product_id"),
    Quantity: dodopayments.F(int64(1)),
  })
  if err != nil {
    panic(err.Error())
  }
  fmt.Printf("%+v\n", subscription.SubscriptionID)
}
  ```
  </Tab>
  <Tab title="Api Reference">
  ```javascript
import { NextRequest, NextResponse } from "next/server";      

export async function POST(request: NextRequest) {
try {
const body = await request.json();
const { formData, cartItems } = paymentRequestSchema.parse(body);

const response = await fetch(`${process.env.NEXT_PUBLIC_DODO_TEST_API}/subscriptions`, {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    Authorization: `Bearer ${process.env.DODO_API_KEY}`, // Replace with your API secret key generated from the Dodo Payments Dashboard
  },
  body: JSON.stringify({
    billing: {
      city: formData.city,
      country: formData.country,
      state: formData.state,
      street: formData.addressLine,
      zipcode: parseInt(formData.zipCode),
    },
    customer: {
      email: formData.email,
      name: `${formData.firstName} ${formData.lastName}`,
      phone_number: formData.phoneNumber || undefined,
    },
    payment_link: true,
    product_id: id,
    quantity: 1,
    return_url: process.env.NEXT_PUBLIC_RETURN_URL,
  }),
});

if (!response.ok) {
  const errorData = await response.json().catch(() => null);
  return NextResponse.json(
    { error: "Payment link creation failed", details: errorData },
    { status: response.status }
  );
}

const data = await response.json();
return NextResponse.json({ paymentLink: data.payment_link });
} catch (err) {
console.error("Payment error:", err);
return NextResponse.json(
  {
    error: err instanceof Error ? err.message : "An unknown error occurred",
  },
  { status: 500 }
);
}
}
  ```
  </Tab>
</Tabs>


### API Response  

The following is an example of the response:  

```json  
{
  "client_secret": "<string>",
  "customer": {
    "customer_id": "<string>",
    "email": "<string>",
    "name": "<string>"
  },
  "metadata": {},
  "payment_link": "<string>",
  "recurring_pre_tax_amount": 1,
  "subscription_id": "<string>"
}
```  

Redirect the customer to `payment_link`.  


### Webhook Integration

Webhooks are essential for subscription management, providing real-time notifications about subscription lifecycle events and payment processing.

<Steps>
  <Step title="Set Up Webhook Endpoint">
    Configure your webhook endpoint to receive subscription events. See our [webhook setup guide](/developer-resources/webhooks) for detailed instructions.
  </Step>
  <Step title="Implement Event Handlers">
    Handle subscription-specific events in your webhook endpoint
  </Step>
  <Step title="Test Webhook Delivery">
    Verify webhook delivery using test mode subscriptions
  </Step>
</Steps>

#### Subscription Event Types

<AccordionGroup>
  <Accordion title="subscription.active">
    **Triggered when:** A subscription is successfully activated and ready for billing
    
    **Timing:** 
    - Immediate billing: Within 2-10 minutes of subscription creation
    - Trial period: When trial period ends
    
    **Use cases:**
    - Grant access to subscription features
    - Send welcome notifications
    - Update customer status in your system
  </Accordion>
  
  <Accordion title="subscription.renewed">
    **Triggered when:** A subscription is renewed for the next billing period
    
    **Note:** This event occurs alongside `payment.succeeded` when payment is processed
    
    **Use cases:**
    - Track billing cycles
    - Update subscription status
    - Send renewal confirmations
  </Accordion>
  
  <Accordion title="subscription.on_hold">
    **Triggered when:** A subscription is put on hold due to payment failure
    
    **Use cases:**
    - Restrict access to subscription features
    - Send payment retry notifications
    - Update customer status
  </Accordion>
  
  <Accordion title="subscription.failed">
    **Triggered when:** Subscription creation fails during mandate setup
    
    **Use cases:**
    - Handle subscription creation errors
    - Notify customer of setup issues
    - Trigger retry mechanisms
  </Accordion>
</AccordionGroup>

#### Payment Event Flow

<Tabs>
  <Tab title="Successful Subscription Flow">
    **Event Sequence:**
    
    1. **`subscription.active`** - Subscription successfully activated
    2. **`payment.succeeded`** - Initial payment processed (if no trial)
    3. **`subscription.renewed`** - Subscription renewed for next cycle
    
    **Timeline:**
    - **No trial period:** Events 1-3 occur within 2-10 minutes
    - **With trial period:** Event 1 immediate, events 2-3 when trial ends
    
    ```javascript
    // Example webhook handler
    app.post('/webhook/dodo-payments', (req, res) => {
      const event = req.body;
      
      switch (event.type) {
        case 'subscription.active':
          // Grant access to subscription features
          await grantSubscriptionAccess(event.data.subscription_id);
          break;
          
        case 'payment.succeeded':
          // Record successful payment
          await recordPayment(event.data.payment_id);
          break;
          
        case 'subscription.renewed':
          // Update billing cycle
          await updateBillingCycle(event.data.subscription_id);
          break;
      }
      
      res.status(200).json({ received: true });
    });
    ```
  </Tab>
  
  <Tab title="Failed Subscription Flow">
    **Event Sequence:**
    
    1. **`subscription.failed`** - Subscription creation failed
    2. **`payment.failed`** - Payment processing failed
    
    **Common Causes:**
    - Payment method declined
    - Insufficient funds
    - Invalid payment details
    - Bank authentication failure
    
    ```javascript
    // Example error handling
    app.post('/webhook/dodo-payments', (req, res) => {
      const event = req.body;
      
      switch (event.type) {
        case 'subscription.failed':
          // Handle subscription creation failure
          await handleSubscriptionFailure(event.data);
          await notifyCustomerOfFailure(event.data.customer_id);
          break;
          
        case 'payment.failed':
          // Handle payment failure
          await handlePaymentFailure(event.data);
          await triggerPaymentRetry(event.data.subscription_id);
          break;
      }
      
      res.status(200).json({ received: true });
    });
    ```
  </Tab>
</Tabs>

<Note>
**Best Practice:** Focus on subscription events (`subscription.*`) for lifecycle management, and use payment events (`payment.*`) for transaction tracking and reconciliation.
</Note>

### Sample Subscription event payload

---

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `business_id` | string | Yes | The unique identifier for the business |
| `timestamp` | string | Yes | The timestamp of when the event occurred (not necessarily the same as when it was delivered) |
| `type` | string | Yes | The type of event. See [Event Types](#event-types) |
| `data` | object | Yes | The main data payload. See [Data Object](#data-object) |

## Changing Subscription Plans

You can upgrade or downgrade a subscription plan using the change plan API endpoint. This allows you to modify the subscription's product, quantity, and handle proration.

<Card title="Change Plan API Reference" icon="arrows-rotate" href="/api-reference/subscriptions/change-plan">
  For detailed information about changing subscription plans, please refer to our Change Plan API documentation.
</Card>

### Proration Options

When changing subscription plans, you have two options for handling the immediate charge:

#### 1. `prorated_immediately`
- Calculates the prorated amount based on the remaining time in the current billing cycle
- Charges the customer only for the difference between the old and new plan
- During a trial period, this will immediately switch the user to the new plan, charging the customer right away

#### 2. `full_immediately`
- Charges the customer the full subscription amount for the new plan
- Ignores any remaining time or credits from the previous plan
- Useful when you want to reset the billing cycle or charge the full amount regardless of proration

### Behavior

- When you invoke this API, Dodo Payments immediately initiates a charge based on your selected proration option
- If the plan change is a downgrade and you use `prorated_immediately`, credits will be automatically calculated and added to the subscription's credit balance. These credits are specific to that subscription and will only be used to offset future recurring payments of the same subscription
- The `full_immediately` option bypasses credit calculations and charges the complete new plan amount

<Tip>
**Choose your proration option carefully**: Use `prorated_immediately` for fair billing that accounts for unused time, or `full_immediately` when you want to charge the complete new plan amount regardless of the current billing cycle.
</Tip>

### Charge Processing

- The immediate charge initiated upon plan change usually completes processing in less than 2 minutes
- If this immediate charge fails for any reason, the subscription is automatically placed on hold until the issue is resolved

## On-Demand Subscriptions

<Info>
  On-demand subscriptions let you charge customers flexibly, not just on a fixed schedule. Contact support to enable this feature.
</Info>

**To create an on-demand subscription:**

To create an on-demand subscription, use the [POST /subscriptions](/api-reference/subscriptions/post-subscriptions) API endpoint and include the `on_demand` field in your request body. This allows you to authorize a payment method without an immediate charge, or set a custom initial price.

**To charge an on-demand subscription:**

For subsequent charges, use the [POST /subscriptions/charge](/api-reference/subscriptions/create-charge) endpoint and specify the amount to charge the customer for that transaction.
