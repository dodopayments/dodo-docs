---
title: Code Integration Tutorial
description: This tutorial demonstrates integrating Dodo Payments into a Next.js app using the Node.js SDK for One-Time and Subscription Products. It utilizes the Dodo Next.js Minimal Boilerplate and covers essential steps to get started efficiently.
icon: "code-compare"

---

## Overview

This comprehensive tutorial walks you through integrating Dodo Payments into a Next.js application from start to finish. You'll learn how to implement both one-time payments and subscription billing using our Node.js SDK with a production-ready boilerplate.

<CardGroup cols={2}>
  <Card title="âš¡ Quick Setup" icon="bolt" href="#boilerplate-setup">
    Get started with our pre-configured boilerplate
  </Card>
  <Card title="ðŸ’³ One-time Payments" icon="credit-card" href="#one-time-payment-product-integration">
    Implement single transaction payments
  </Card>
  <Card title="ðŸ”„ Subscriptions" icon="repeat" href="#subscription-payment-product-integration">
    Set up recurring billing and subscriptions
  </Card>
  <Card title="ðŸ”” Webhooks" icon="bell" href="#webhook-integration">
    Handle real-time payment events
  </Card>
</CardGroup>

## What You'll Build

By the end of this tutorial, you'll have:

- âœ… A fully functional payment integration
- âœ… Support for both one-time and subscription payments
- âœ… Secure webhook handling for payment events
- âœ… Proper error handling and user feedback
- âœ… Test environment setup for safe development

## Prerequisites

<Steps>
  <Step title="Account & API Setup">
    Ensure you have the necessary accounts and credentials:
    
    <AccordionGroup>
      <Accordion title="Dodo Payments Account">
        - [Create a Dodo Payments account](/quickstart) if you haven't already
        - Complete account verification process
        - Access your merchant dashboard
      </Accordion>
      
      <Accordion title="API Keys">
        - [Obtain your API keys](/api-reference/introduction#authentication) from the dashboard
        - Get both test and live environment keys
        - Understand the difference between publishable and secret keys
      </Accordion>
    </AccordionGroup>
    
    <Warning>
      **Security Note**: Never expose secret API keys in client-side code. Use environment variables and keep them secure.
    </Warning>
  </Step>
  
  <Step title="Development Environment">
    Set up your development tools and environment:
    
    <Tabs>
      <Tab title="Required Tools">
        - **Node.js**: Version 14 or higher
        - **npm** or **yarn**: Latest version
        - **Git**: For cloning the boilerplate repository
        - **Code Editor**: VS Code recommended with React/Next.js extensions
      </Tab>
      
      <Tab title="Knowledge Prerequisites">
        - **JavaScript/TypeScript**: Intermediate level
        - **React**: Basic component and hooks knowledge
        - **Next.js**: Understanding of API routes and SSR/SSG
        - **REST APIs**: Basic understanding of HTTP methods and responses
      </Tab>
    </Tabs>
  </Step>
  
  <Step title="Optional but Recommended">
    Additional tools that will enhance your development experience:
    
    - **Postman** or **Insomnia**: For API testing
    - **ngrok**: For webhook testing in development
    - **Stripe CLI** or similar: For webhook event simulation
    - **React DevTools**: Browser extension for debugging
  </Step>
</Steps>

## Boilerplate Setup

<Steps>
  <Step title="Clone the Repository">
    Get our production-ready Next.js boilerplate:
    
    ```bash
    git clone https://github.com/dodopayments/dodo-nextjs-minimal-boilerplate
    cd dodo-nextjs-minimal-boilerplate
    ```
    
    **What's Included:**
    - Pre-configured Next.js 13+ with App Router
    - Dodo Payments SDK integration
    - TypeScript configuration
    - Environment variable setup
    - Basic UI components and styling
  </Step>
  
  <Step title="Install Dependencies">
    Install all required packages:
    
    <Tabs>
      <Tab title="npm">
        ```bash
        npm install
        ```
      </Tab>
      <Tab title="yarn">
        ```bash
        yarn install
        ```
      </Tab>
      <Tab title="pnpm">
        ```bash
        pnpm install
        ```
      </Tab>
    </Tabs>
    
    This installs:
    - `@dodopayments/node`: Official Node.js SDK
    - `next`: Next.js framework
    - `react`: React library
    - `typescript`: TypeScript support
    - Additional utilities and development tools
  </Step>
  
  <Step title="Environment Configuration">
    Set up your environment variables:
    
    ```bash
    cp .env.example .env.local
    ```
    
    Edit `.env.local` with your actual API keys:
    
    ```env
    # Dodo Payments API Keys
    DODO_PAYMENTS_SECRET_KEY=your_secret_key_here
    DODO_PAYMENTS_PUBLISHABLE_KEY=your_publishable_key_here
    
    # Webhook Configuration
    WEBHOOK_SECRET=your_webhook_secret_here
    
    # Environment
    NODE_ENV=development
    NEXT_PUBLIC_APP_URL=http://localhost:3000
    ```
    
    <Warning>
      **Important**: Use test API keys during development. Switch to live keys only when deploying to production.
    </Warning>
  </Step>
  
  <Step title="Start Development Server">
    Launch the development environment:
    
    ```bash
    npm run dev
    ```
    
    Your application will be available at `http://localhost:3000`
    
    **Verify Setup:**
    - âœ… Homepage loads without errors
    - âœ… Payment components render correctly
    - âœ… Console shows no configuration errors
    - âœ… Environment variables are properly loaded
  </Step>
</Steps>

<Note>
**Boilerplate Features**: The boilerplate includes pre-built components for payments, comprehensive error handling, TypeScript definitions, and a clean project structure following Next.js best practices.
</Note>

## Integration Paths

Choose the right integration approach for your use case:

<Tabs>
  <Tab title="One-Time Payments">
    Perfect for:
    - Digital product sales
    - Physical goods
    - Service bookings
    - License purchases
    
    **Implementation highlights:**
    - Simple payment flow
    - Immediate payment confirmation
    - One-time webhook events
    - Customer receipt generation
  </Tab>
  
  <Tab title="Subscription Billing">
    Ideal for:
    - SaaS applications
    - Membership sites
    - Content subscriptions
    - Service retainers
    
    **Implementation highlights:**
    - Recurring payment automation
    - Subscription lifecycle management
    - Prorated billing support
    - Customer portal integration
  </Tab>
  
  <Tab title="Hybrid Approach">
    Best for:
    - Freemium models with upgrades
    - Products with add-on purchases
    - Services with one-time setup fees
    - Flexible pricing models
    
    **Implementation highlights:**
    - Multiple payment types
    - Complex billing scenarios
    - Advanced subscription management
    - Comprehensive event handling
  </Tab>
</Tabs>

## One-Time Payment Product Integration

Learn how to implement one-time payments in your application:

<iframe 
    className="w-full aspect-video rounded-md" 
    src="https://www.youtube.com/embed/3igzmVkVDbY"
    title="One-Time Payment Integration | Dodo Payments"
    frameBorder="0"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
    allowFullScreen
></iframe>

### Key Steps

<Steps>
  1. [Initialize the SDK](/developer-resources/dodo-payments-sdks#initialization)
  2. [Create a product](/api-reference/products/post-products)
  3. [Generate a payment link](/api-reference/payments/post-payments)
  4. [Handle webhooks](/developer-resources/webhooks/intents/payment)
</Steps>

## Subscription Payment Product Integration

Learn how to implement subscription payments:

<iframe 
    className="w-full aspect-video rounded-md" 
    src="https://www.youtube.com/embed/rj62ral2rek"
    title="Subscription Integration | Dodo Payments"
    frameBorder="0"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
    allowFullScreen
></iframe>

### Key Steps

<Steps>
  1. [Initialize the SDK](/developer-resources/dodo-payments-sdks#initialization)
  2. [Create a subscription product](/api-reference/products/post-products)
  3. [Create a subscription](/api-reference/subscriptions/post-subscriptions)
  4. [Handle subscription webhooks](/developer-resources/webhooks/intents/subscription)
</Steps>

## Webhook Integration

<Steps>
  <Step title="Webhook Endpoint Setup">
    Create a secure webhook handler in your Next.js API routes:
    
    ```typescript pages/api/webhooks/dodo.ts
    import { NextApiRequest, NextApiResponse } from 'next';
    import { verifyWebhookSignature } from '@dodopayments/node';
    import { buffer } from 'micro';
    
    // Disable body parsing to get raw body for signature verification
    export const config = {
      api: {
        bodyParser: false,
      },
    };
    
    export default async function handler(
      req: NextApiRequest,
      res: NextApiResponse
    ) {
      if (req.method !== 'POST') {
        return res.status(405).json({ error: 'Method not allowed' });
      }
    
      try {
        // Get raw body for signature verification
        const body = await buffer(req);
        const signature = req.headers['dodo-signature'] as string;
        
        if (!signature) {
          return res.status(400).json({ error: 'Missing signature' });
        }
    
        // Verify webhook signature
        const isValid = verifyWebhookSignature({
          payload: body.toString(),
          signature,
          secret: process.env.WEBHOOK_SECRET!
        });
    
        if (!isValid) {
          return res.status(400).json({ error: 'Invalid signature' });
        }
    
        // Parse the verified payload
        const event = JSON.parse(body.toString());
        
        // Handle the webhook event
        await handleWebhookEvent(event);
        
        res.status(200).json({ received: true });
      } catch (error) {
        console.error('Webhook error:', error);
        res.status(500).json({ error: 'Webhook processing failed' });
      }
    }
    
    async function handleWebhookEvent(event: any) {
      console.log('Processing webhook event:', event.type);
      
      switch (event.type) {
        case 'payment.succeeded':
          await handlePaymentSucceeded(event.data);
          break;
          
        case 'payment.failed':
          await handlePaymentFailed(event.data);
          break;
          
        case 'subscription.created':
          await handleSubscriptionCreated(event.data);
          break;
          
        case 'subscription.cancelled':
          await handleSubscriptionCancelled(event.data);
          break;
          
        case 'subscription.invoice.paid':
          await handleInvoicePaid(event.data);
          break;
          
        default:
          console.log('Unhandled webhook event type:', event.type);
      }
    }
    ```
  </Step>
  
  <Step title="Event Handlers Implementation">
    Implement specific handlers for each webhook event type:
    
    <Tabs>
      <Tab title="Payment Events">
        ```typescript lib/webhook-handlers/payment.ts
        import { updateUserPaymentStatus } from '../database';
        import { sendConfirmationEmail } from '../email';
        
        export async function handlePaymentSucceeded(paymentData: any) {
          try {
            // Update database with successful payment
            await updateUserPaymentStatus({
              userId: paymentData.metadata.user_id,
              paymentId: paymentData.id,
              status: 'completed',
              amount: paymentData.amount,
              currency: paymentData.currency
            });
            
            // Send confirmation email to customer
            await sendConfirmationEmail({
              email: paymentData.customer.email,
              paymentId: paymentData.id,
              amount: paymentData.amount,
              currency: paymentData.currency
            });
            
            // Grant access to purchased product/service
            await grantProductAccess({
              userId: paymentData.metadata.user_id,
              productId: paymentData.metadata.product_id
            });
            
            console.log('Payment succeeded processed:', paymentData.id);
          } catch (error) {
            console.error('Error processing payment success:', error);
            throw error;
          }
        }
        
        export async function handlePaymentFailed(paymentData: any) {
          try {
            // Update payment status
            await updateUserPaymentStatus({
              userId: paymentData.metadata.user_id,
              paymentId: paymentData.id,
              status: 'failed',
              failureReason: paymentData.failure_reason
            });
            
            // Send failure notification
            await sendPaymentFailureEmail({
              email: paymentData.customer.email,
              paymentId: paymentData.id,
              reason: paymentData.failure_reason
            });
            
            console.log('Payment failure processed:', paymentData.id);
          } catch (error) {
            console.error('Error processing payment failure:', error);
            throw error;
          }
        }
        ```
      </Tab>
      
      <Tab title="Subscription Events">
        ```typescript lib/webhook-handlers/subscription.ts
        import { createSubscriptionRecord, updateSubscriptionStatus } from '../database';
        
        export async function handleSubscriptionCreated(subscriptionData: any) {
          try {
            // Create subscription record in database
            await createSubscriptionRecord({
              subscriptionId: subscriptionData.id,
              userId: subscriptionData.metadata.user_id,
              productId: subscriptionData.metadata.product_id,
              status: subscriptionData.status,
              billingCycle: subscriptionData.billing_cycle,
              amount: subscriptionData.amount,
              currency: subscriptionData.currency,
              startDate: subscriptionData.current_period_start,
              endDate: subscriptionData.current_period_end
            });
            
            // Grant subscription access
            await grantSubscriptionAccess({
              userId: subscriptionData.metadata.user_id,
              subscriptionId: subscriptionData.id
            });
            
            // Send welcome email
            await sendSubscriptionWelcomeEmail({
              email: subscriptionData.customer.email,
              subscriptionId: subscriptionData.id
            });
            
            console.log('Subscription created:', subscriptionData.id);
          } catch (error) {
            console.error('Error processing subscription creation:', error);
            throw error;
          }
        }
        
        export async function handleSubscriptionCancelled(subscriptionData: any) {
          try {
            // Update subscription status
            await updateSubscriptionStatus({
              subscriptionId: subscriptionData.id,
              status: 'cancelled',
              cancelledAt: subscriptionData.cancelled_at
            });
            
            // Revoke access at period end
            await scheduleAccessRevocation({
              userId: subscriptionData.metadata.user_id,
              revokeAt: subscriptionData.current_period_end
            });
            
            // Send cancellation confirmation
            await sendCancellationEmail({
              email: subscriptionData.customer.email,
              subscriptionId: subscriptionData.id,
              accessUntil: subscriptionData.current_period_end
            });
            
            console.log('Subscription cancelled:', subscriptionData.id);
          } catch (error) {
            console.error('Error processing subscription cancellation:', error);
            throw error;
          }
        }
        ```
      </Tab>
    </Tabs>
  </Step>
  
  <Step title="Webhook Testing">
    Test your webhook implementation:
    
    <AccordionGroup>
      <Accordion title="Local Development Testing">
        Use ngrok to expose your local server:
        
        ```bash
        # Install ngrok
        npm install -g ngrok
        
        # Expose your local server
        ngrok http 3000
        ```
        
        Then configure the webhook URL in your Dodo Payments dashboard:
        `https://your-ngrok-url.ngrok.io/api/webhooks/dodo`
      </Accordion>
      
      <Accordion title="Manual Testing">
        Create a test webhook event using cURL:
        
        ```bash
        curl -X POST http://localhost:3000/api/webhooks/dodo \
          -H "Content-Type: application/json" \
          -H "dodo-signature: your-test-signature" \
          -d '{
            "type": "payment.succeeded",
            "data": {
              "id": "pay_test_123",
              "amount": 2999,
              "currency": "USD",
              "status": "succeeded",
              "metadata": {
                "user_id": "user_123",
                "product_id": "prod_123"
              },
              "customer": {
                "email": "test@example.com"
              }
            }
          }'
        ```
      </Accordion>
    </AccordionGroup>
  </Step>
</Steps>

## Testing Your Integration

<Tabs>
  <Tab title="Payment Testing">
    Comprehensive testing checklist for payment flows:
    
    **Test Environment Setup:**
    1. âœ… Use [test API keys](/miscellaneous/test-mode-vs-live-mode) in development
    2. âœ… Configure test webhook endpoints
    3. âœ… Set up test user accounts
    
    **Payment Flow Testing:**
    
    <AccordionGroup>
      <Accordion title="Successful Payments">
        Test successful payment scenarios:
        
        - Use [test card numbers](/miscellaneous/testing-process):
          - `4242424242424242` (Visa)
          - `5555555555554444` (Mastercard)
          - `378282246310005` (American Express)
        - Verify payment completion
        - Check webhook event delivery
        - Confirm database updates
        - Test user access grants
      </Accordion>
      
      <Accordion title="Failed Payments">
        Test payment failure scenarios:
        
        - Declined cards: `4000000000000002`
        - Insufficient funds: `4000000000009995`
        - Expired cards: `4000000000000069`
        - Invalid CVC: `4000000000000127`
        - Verify error handling and user messaging
      </Accordion>
      
      <Accordion title="Edge Cases">
        Test edge cases and error conditions:
        
        - Network timeouts
        - Invalid API keys
        - Malformed requests
        - Webhook signature validation
        - Rate limiting scenarios
      </Accordion>
    </AccordionGroup>
  </Tab>
  
  <Tab title="Subscription Testing">
    Test subscription-specific scenarios:
    
    **Subscription Lifecycle:**
    1. âœ… Subscription creation
    2. âœ… First payment processing
    3. âœ… Recurring payments (use test mode acceleration)
    4. âœ… Subscription modifications
    5. âœ… Cancellation handling
    
    **Test Scenarios:**
    - Trial period expiration
    - Payment method updates
    - Billing cycle changes
    - Proration calculations
    - Failed recurring payments
    
    **Webhook Events to Test:**
    - `subscription.created`
    - `subscription.invoice.paid`
    - `subscription.invoice.payment_failed`
    - `subscription.cancelled`
  </Tab>
  
  <Tab title="Webhook Testing">
    Verify webhook reliability and security:
    
    **Security Testing:**
    ```javascript
    // Test signature verification
    const testWebhookSecurity = async () => {
      // Valid signature should pass
      const validResponse = await fetch('/api/webhooks/dodo', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'dodo-signature': 'valid_signature_here'
        },
        body: JSON.stringify(testEvent)
      });
      
      // Invalid signature should be rejected
      const invalidResponse = await fetch('/api/webhooks/dodo', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'dodo-signature': 'invalid_signature'
        },
        body: JSON.stringify(testEvent)
      });
      
      console.log('Valid signature:', validResponse.status === 200);
      console.log('Invalid signature rejected:', invalidResponse.status === 400);
    };
    ```
    
    **Reliability Testing:**
    - Test webhook retry logic
    - Verify idempotency handling
    - Check timeout handling
    - Test concurrent webhook processing
  </Tab>
</Tabs>

## Troubleshooting Common Issues

<AccordionGroup>
  <Accordion title="Payment Failures">
    **Common Causes & Solutions:**
    
    - **Invalid API Keys**: Verify test/live environment keys match your dashboard
    - **Network Issues**: Implement retry logic with exponential backoff
    - **Card Declined**: Provide clear user messaging and alternative payment options
    - **Amount Validation**: Ensure amounts are in smallest currency unit (cents)
    
    **Debugging Steps:**
    1. Check API response error messages
    2. Verify request payload format
    3. Test with known-good test cards
    4. Review network logs for connection issues
    
    See: [Handling failed payments](/api-reference/technical-faqs#failed-payments)
  </Accordion>
  
  <Accordion title="Webhook Issues">
    **Common Problems:**
    
    - **Signature Verification Failures**: Check webhook secret configuration
    - **Timeout Issues**: Optimize webhook handler performance
    - **Duplicate Events**: Implement idempotency checks
    - **Missing Events**: Verify webhook URL configuration
    
    **Resolution Steps:**
    1. Test webhook endpoint manually
    2. Check webhook logs in dashboard
    3. Verify signature generation
    4. Test with ngrok in development
    
    See: [Webhook timeouts](/api-reference/technical-faqs#webhook-timeouts)
  </Accordion>
  
  <Accordion title="Authentication Errors">
    **Common Authentication Issues:**
    
    - **401 Unauthorized**: Check API key format and validity
    - **403 Forbidden**: Verify API key permissions for endpoint
    - **Environment Mismatch**: Ensure test keys are used in test mode
    
    **Quick Fixes:**
    1. Regenerate API keys from dashboard
    2. Verify environment variable names
    3. Check Bearer token format
    4. Test with a simple API call first
    
    See: [Authentication errors](/api-reference/technical-faqs#authentication-errors)
  </Accordion>
</AccordionGroup>

## Next Steps

<CardGroup cols={2}>
  <Card title="API Reference" icon="code" href="/api-reference/payments/get-payments">
    Explore all available endpoints
  </Card>
  <Card title="SDKs" icon="box" href="/developer-resources/dodo-payments-sdks">
    View SDK documentation
  </Card>
  <Card title="Webhooks" icon="bell" href="/developer-resources/webhooks/intents/webhook-events-guide">
    Learn about webhook events
  </Card>
  <Card title="Testing" icon="vial" href="/miscellaneous/testing-process">
    Test your integration
  </Card>
</CardGroup>

## Deployment Checklist

<Steps>
  <Step title="Pre-Production Verification">
    âœ… **Security Audit**
    - API keys stored securely in environment variables
    - Webhook signature verification implemented
    - HTTPS enabled for all endpoints
    - Input validation on all user inputs
    
    âœ… **Functionality Testing**
    - All payment flows tested end-to-end
    - Webhook handlers working correctly
    - Error handling provides good user experience
    - Database operations are atomic and reliable
  </Step>
  
  <Step title="Production Configuration">
    âœ… **Environment Variables**
    ```env
    # Switch to live API keys
    DODO_PAYMENTS_SECRET_KEY=your_live_secret_key
    DODO_PAYMENTS_PUBLISHABLE_KEY=your_live_publishable_key
    WEBHOOK_SECRET=your_live_webhook_secret
    NODE_ENV=production
    ```
    
    âœ… **Webhook URLs**
    - Update webhook URLs in dashboard to production endpoints
    - Test webhook delivery to production environment
    - Monitor webhook retry attempts and failures
  </Step>
  
  <Step title="Go Live">
    âœ… **Final Checks**
    - Process test payment in production
    - Verify all integrations work correctly
    - Monitor error logs and metrics
    - Have rollback plan ready
    
    âœ… **Post-Launch Monitoring**
    - Set up payment success/failure alerts
    - Monitor webhook processing times
    - Track payment conversion rates
    - Review user feedback and support tickets
  </Step>
</Steps>

## Next Steps & Resources

<CardGroup cols={2}>
  <Card title="Advanced Features" icon="star" href="/developer-resources/subscription-integration-guide">
    Explore advanced subscription features
  </Card>
  <Card title="Mobile Integration" icon="mobile" href="/developer-resources/react-native-integration">
    Add mobile payment support
  </Card>
  <Card title="License Management" icon="key" href="/developer-resources/license-keys-api-usage">
    Implement license key validation
  </Card>
  <Card title="Analytics" icon="chart-line" href="/api-reference/analytics">
    Track payment analytics and metrics
  </Card>
</CardGroup>

## Need Help?

<AccordionGroup>
  <Accordion title="Community & Support">
    - ðŸ’¬ [Developer Community](https://community.dodopayments.com) - Get help from other developers
    - ðŸ“š [Technical FAQs](/api-reference/technical-faqs) - Common questions and answers
    - ðŸŽ« [Developer Support](/miscellaneous/help-support) - Direct support for integration issues
    - ðŸ“– [API Documentation](/api-reference/payments/get-payments) - Complete API reference
  </Accordion>
  
  <Accordion title="Additional Resources">
    - ðŸŽ¥ **Video Tutorials**: Linked throughout this guide for visual learners
    - ðŸ”§ **SDK Documentation**: Platform-specific guides for different languages
    - ðŸ§ª **Testing Tools**: Comprehensive testing strategies and test data
    - ðŸš€ **Best Practices**: Security, performance, and user experience guidelines
  </Accordion>
</AccordionGroup>