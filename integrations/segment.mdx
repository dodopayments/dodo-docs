---
title: "Segment"
description: "Send Dodo Payments events to Segment for analytics and customer data platform integration."
icon: "chart-line"
---

## Introduction

Track payment events in Segment to power your analytics, marketing automation, and customer data platform. Send payment, subscription, and customer lifecycle events to 300+ downstream tools automatically.

<Info>
This integration requires a Segment Write Key from your Segment workspace.
</Info>

## Getting Started

<Steps>
<Step title="Open the Webhook Section">
  In your Dodo Payments dashboard, navigate to <b>Webhooks â†’ + Add Endpoint</b> and expand the integrations dropdown.
  <Frame>
    <img src="/images/integrations/segment.png" alt="Add Endpoint and integrations dropdown" />
  </Frame>
</Step>

<Step title="Select Segment">
  Choose the <b>Segment</b> integration card.
</Step>

<Step title="Enter Write Key">
  Provide your Segment Write Key in the configuration.
</Step>

<Step title="Configure Transformation">
  Edit the transformation code to format events for Segment's Track API.
</Step>

<Step title="Test & Create">
  Test with sample payloads and click <b>Create</b> to activate the sync.
</Step>

<Step title="Done!">
  ðŸŽ‰ Payment events will now be tracked in Segment and sent to your connected tools.
</Step>
</Steps>

## Transformation Code Examples

### Track Payment Events

```javascript track_payments.js icon="js" expandable
function handler(webhook) {
  if (webhook.eventType === "payment.succeeded") {
    const p = webhook.payload.data;
    webhook.url = "https://api.segment.io/v1/track";
    webhook.payload = {
      userId: p.customer.customer_id,
      event: "Payment Completed",
      properties: {
        amount: (p.total_amount / 100).toFixed(2),
        currency: p.currency || "USD",
        payment_method: p.payment_method || "unknown",
        payment_id: p.payment_id,
        customer_email: p.customer.email,
        customer_name: p.customer.name
      },
      timestamp: webhook.payload.timestamp
    };
  }
  return webhook;
}
```

### Track Subscription Lifecycle

```javascript track_subscriptions.js icon="js" expandable
function handler(webhook) {
  const s = webhook.payload.data;
  switch (webhook.eventType) {
    case "subscription.active":
      webhook.url = "https://api.segment.io/v1/track";
      webhook.payload = {
        userId: s.customer.customer_id,
        event: "Subscription Started",
        properties: {
          subscription_id: s.subscription_id,
          product_id: s.product_id,
          amount: (s.recurring_pre_tax_amount / 100).toFixed(2),
          frequency: s.payment_frequency_interval,
          next_billing: s.next_billing_date,
          customer_email: s.customer.email
        },
        timestamp: webhook.payload.timestamp
      };
      break;
    case "subscription.cancelled":
      webhook.url = "https://api.segment.io/v1/track";
      webhook.payload = {
        userId: s.customer.customer_id,
        event: "Subscription Cancelled",
        properties: {
          subscription_id: s.subscription_id,
          product_id: s.product_id,
          cancelled_at: s.cancelled_at,
          cancel_at_next_billing: s.cancel_at_next_billing_date,
          customer_email: s.customer.email
        },
        timestamp: webhook.payload.timestamp
      };
      break;
  }
  return webhook;
}
```

### Identify Customer Properties

```javascript identify_customer.js icon="js" expandable
function handler(webhook) {
  if (webhook.eventType === "payment.succeeded") {
    const p = webhook.payload.data;
    webhook.url = "https://api.segment.io/v1/identify";
    webhook.payload = {
      userId: p.customer.customer_id,
      traits: {
        email: p.customer.email,
        name: p.customer.name,
        total_spent: (p.total_amount / 100).toFixed(2),
        payment_method: p.payment_method || "unknown",
        last_payment_date: webhook.payload.timestamp,
        customer_since: webhook.payload.timestamp
      }
    };
  }
  return webhook;
}
```

## Tips

- Use consistent event names across your integration
- Include relevant properties for analytics and segmentation
- Set proper timestamps for accurate event tracking
- Use customer IDs as userId for proper user identification

## Troubleshooting

<AccordionGroup>
<Accordion title="Events not appearing in Segment">
- Verify Write Key is correct and active
- Check that event names follow Segment naming conventions
- Ensure userId is properly set for user identification
- Review Segment API rate limits
</Accordion>

<Accordion title="Transformation errors">
- Validate JSON structure matches Segment API format
- Check that all required fields are present
- Ensure event names are strings, not objects
</Accordion>
</AccordionGroup>